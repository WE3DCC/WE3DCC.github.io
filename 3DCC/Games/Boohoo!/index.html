<html>
    <head>
        <title>We3D.CC:BooHoo!.Altspacevs</title>
        <script src="https://aframe.io/releases/0.3.0/aframe.min.js"></script>
        <script src="https://sdk.altvr.com/libs/altspace.js/2.6.1/altspace.min.js"></script>
        <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
        <script> AFRAME.registerComponent('hider', {
            init: function () {
                var TimesShown = 0;
                var booHoo = document.querySelector('#BooHoo1');
                //turn off Boo visibility and sync game to player who clicks on boo 
                booHoo.addEventListener('mousedown', function(){
                    booHoo.setAttribute('visible', false);
                    booHoo.components.sync.takeOwnership();
                    TimesShown += 1;
                    booHoo.emit('boogone');
                    }.bind(this));
                booHoo.emit('spin');
                console.log('TimeShown is ' + TimesShown);
                console.log('Gamestart');
                },
            update: function () {
                // var randpos = AFRAME.utils.coordinates.stringify(this.data.randomposition);
                // Listen for Player click and set new random position
                booHoo.addEventListener("componentchanged",function(){
                    if (event.detail.name === 'visible') {
                        var max = 10;
                        var min = -10;
                        var ymin = 0;
                        var boohoo3d = this.el.object3D;
                        var hidex = Math.floor(Math.random() * (max - min)) + min;
                        var hidey = Math.floor(Math.random() * (max - ymin)) + ymin;
                        var hidez = Math.floor(Math.random() * (max - min)) + min;
                        //var animation = document.createElement("a-animation");
                        //    animation.setAttribute("attribute","position");
                        //    animation.setAttribute("begin","hideMe");
                         //   animation.setAttribute("to", newHidingSpot);
                        //    animation.setAttribute("dur","2000");
                        //    animation.setAttribute("repeat","0");
                        //    booHoo.appendChild(animation);
                        boohoo3d.position.set(hidex, hidey, hidez);
                        };
                    booHoo.addState('moved');
                    console.log('Entity moved to ' + newHidingSpot);
                    });
                // Spin Boo {play sound} and turn on visiblity
                booHoo.addEventListener('stateadded', function(event){
                    if (event.detail.state === 'moved') {
                        booHoo.setAttribute('visible', true);
                        booHoo.emit('spin'); 
                        console.log('Find me!');
                        };
                    }.bind(this));
                },
            });
        </script>
    </head>
    <body>
        <a-scene debug sync-system="author: 3dcc; app: boohoo!" altspace="fullspace: true">
            <a-assets>
                <a-asset-item id="boohooObj" src="models/BooHootheGhost.obj"></a-asset-item>
                <a-asset-item id="boohooMtl" src="models/BooHootheGhost.mtl"></a-assset-item>
                <a-mixin id="coneGeo" geometry="primitive: cone; radius-top: 0; radius-bottom: 0.5" material="color: grey"></a-mixin>
                <a-mixin id="sphereGeo" geometry="primitive: sphere; radius: 0.5;" material="color: grey"></a-mixin>
                <a-mixin id="yoyoAni" attribute="position" direction="alternate"
                    dur="3000" fill="forwards" to="1 1 1"repeat="indefinite"></a-mixin>
                <a-mixin id="Spinning" attribute="rotation" direction="reverse"
                    dur="2000" fill="forwards" to="0 360 0" repeat="indefinite"></a-mixin>
            </a-assets>
            
            <!-- Cardboard Camera -->
            <a-entity position="0 2.2 2">
                <a-entity camera look-controls>
                    <a-entity
                        cursor="maxDistance: 30; fuse: false; fuseTimeout: 1600" position="0 0 -3"
                        geometry="primitive: ring; radiusOuter: 0.30; radiusInner: 0.20"
                        material="color: cyan; shader: flat">
                        <a-animation begin="mouseenter" easing="linear" attribute="scale"
                            fill="forwards" from="4 4 4" to="0.1 0.1 0.1" dur="1500" end="mouseleave"></a-animation>
                        <a-animation begin="mouseleave" dur="50" easing="ease-out-bounce" attribute="scale"
                            fill="forwards" from="1 1 1" to="1 1 1" ></a-animation> 
                        <a-animation begin="click" dur="20" easing="ease-out-bounce" attribute="scale"
                            fill="forwards" direction="backwards" from="0.5 0.5 0.5" to="1 1 1" ></a-animation> 
                    </a-entity>
                </a-entity>
            </a-entity>
            <!--n-mesh-collider="convex: false; height: 2; radius: 2; type: 'object'" -->
            <a-entity id="BooHoo1"
                hider
                wire="on:boogone; emit: hideMe"
                altspace-cursor-collider
                sync sync-transform sync-color>
                <a-entity obj-model="obj: #boohooObj; mtl:#boohooMtl"></a-entity>
                <a-animation mixin="Spinning" begin="spin"></a-animation>
            </a-entity>
            
            <a-entity random-position>
                <a-entity mixin="sphereGeo yoyoAni"></a-entity>
            </a-entity>
        </a-scene>
    </body>
</html>
    
