<html>
    <head>
        <title>A-Frame Altspace Component - Test Sync</title>
        <script src="https://aframe.io/releases/0.3.0/aframe.min.js"></script>
        <script src="https://sdk.altvr.com/libs/altspace.js/2.6.1/altspace.min.js"></script>
        <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
         <script> AFRAME.registerComponent('HideandPlaceBoo', function() {
            var booHoo = document.querySelector('#BooHoo1');
            init: function () {
                var TimesShown = 0;
                booHoo.addEventListener('mousedown', function(){
                    //Toggle visibility off
                    this.el.object3D.setAttribute('visible', false);
                    booHoo.emit('booisgone');
                    //sync game to player who clicks on boo first
                    TimesShown += 1;
                    console.log('TimeShown is ' + TimeShown);
                    booHoo.components.sync.takeOwnership();
                });
                
                }, 
                    
            update: function () {
                // Listen for Player Finding Click
                booHoo.addEventListener('componentchanged', function(event){
                    if (event.detail.name === 'visible') {
                        var max = 10;
                        var min = -10;
                        var ymin = 0;
                        var randomHidingSpot = 
                        {x: (Math.floor(Math.random() * (max - min + 1) ) + min), 
                         y: (Math.floor(Math.random() * (max - ymin + 1) ) + ymin),
                         z: (Math.floor(Math.random() * (max - min + 1) ) + min)};
                        booHoo.setAttribute("position", randomHidingSpot);
                        this.el.object3D.position.set('visible', true);    
                        };
                    });
                },
            });
        </script>
    </head>
    <body>
        <a-scene sync-system="author: 3dcc; app: boohoo!" altspace="fullspace: true">
            
            <a-assets>
                <a-asset-item id="boohooObj" src="models/BooHootheGhost.obj"></a-asset-item>
                <a-asset-item id="boohooMtl" src="models/BooHootheGhost.mtl"></a-assset-item>
                <a-mixin id="coneGeo" geometry="primitive: cone; radius-top: 0; radius-bottom: 0.5" material="color: grey"></a-mixin>
                <a-mixin id="sphereGeo" geometry="primitive: sphere; radius: 0.5;" material="color: grey"></a-mixin>
                <a-mixin id="yoyoAni" attribute="position" direction="alternate"
                    dur="3000" fill="forwards" to="1 1 1"repeat="indefinite"></a-mixin>
                <a-mixin id="FoundMe" attribute="rotation" direction="reverse"
                    dur="2000" fill="forwards"></a-mixin>
                <a-mixin id="RevealMe" attribute="visibility" direction="normal"
                    dur="3000" fill="forwards"></a-mixin>
            </a-assets>
            
            <!-- Cardboard Camera -->
            <a-entity position="0 2.2 2">
                <a-entity camera look-controls>
                    <a-entity cursor="maxDistance: 30; fuse: false; fuseTimeout: 1600" position="0 0 -3"
                                geometry="primitive: ring; radiusOuter: 0.30;
                                        radiusInner: 0.20;"
                                material="color: cyan; shader: flat">
                         <a-animation begin="mouseenter" easing="linear" attribute="scale"
                            fill="forwards" from="4 4 4" to="0.1 0.1 0.1" dur="1500" end="mouseleave"></a-animation>
                        <a-animation begin="mouseleave" dur="50" easing="ease-out-bounce" attribute="scale"
                            fill="forwards" from="1 1 1" to="1 1 1" ></a-animation> 
                        <a-animation begin="click" dur="20" easing="ease-out-bounce" attribute="scale"
                            fill="forwards" direction="backwards" from="0.5 0.5 0.5" to="1 1 1" ></a-animation> 
                     </a-entity>
                </a-entity>
            </a-entity>

            <a-entity id="BooHoo1"
                obj-model="obj: #boohooObj; mtl:#boohooMtl"
                HideandPlaceBoo
                random-position
                altspace-cursor-collider
                wire="on:click; emit: boofound"
                sync sync-transform sync-color>
                <a-animation mixin="FoundMe" to="0 360 0" ></a-animation>
            </a-entity>
            
            <a-entity random-position>
                <a-entity mixin="sphereGeo yoyoAni"></a-entity>
            </a-entity>
            
        </a-scene>
        <!-- 
           
        -->
    </body>
</html>
    
